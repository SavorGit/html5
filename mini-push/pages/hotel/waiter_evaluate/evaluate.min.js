$(document).ready(function(c){$("title").html("亲，您对服务满意吗？");$("input,textarea").blur(function(){$("html,body").animate({scrollTop:document.documentElement.clientHeight},500)});var b=pageConfig.apiURLDomain.prod;if("devp"==runEnv){b=pageConfig.apiURLDomain.devp}$(".waiter-evaluate-score-panel>.wapper>.lable").click(function(k){logger.SHOW_CONSOLE_CLICK_COUNT++;if(logger.SHOW_CONSOLE_CLICK_COUNT>=30){$("#console").show()}});JohnLeeConsole.print("服务员信息："+JSON.stringify(waiterInfo));JohnLeeConsole.print("默认分值："+JSON.stringify(defaultScore));JohnLeeConsole.print("标签列表："+JSON.stringify(tagArray));JohnLeeConsole.print("默认评论："+JSON.stringify(defaultComment));if(typeof(waiterInfo)=="object"){var j=$(".waiter-evaluate-info-panel");if(typeof(waiterInfo.name)=="string"){j.find(".wapper").attr("waiter-id",waiterInfo.id)}if(typeof(waiterInfo.name)=="string"&&waiterInfo.name.trim()!=""){j.find(".info>.name").text(waiterInfo.name)}else{j.find(".info>.name").html('<div style="color:#BEBEBE;">无</span>')}if(typeof(waiterInfo.title)=="string"&&waiterInfo.name.trim()!=""){j.find(".info>.title").addClass("theme-font7").text(waiterInfo.title)}else{j.find(".info>.title").html('<div style="color:#BEBEBE;">无</span>')}if(typeof(waiterInfo.photo)=="string"&&waiterInfo.name.trim()!=""){j.find("img.photo").attr("src",waiterInfo.photo)}else{j.find("img.photo").attr("src","https://oss.littlehotspot.com/Html5/images/common/default_user_head_1.jpg")}}var a=0;if(typeof(defaultScore)!="number"){a=defaultScore}else{try{a=parseFloat(defaultScore)}catch(d){a=0}}var g=$(".waiter-evaluate-score-panel .star-group").empty();if(typeof(pageConfig.starCount)=="number"&&pageConfig.starCount>0){for(index=0;index<pageConfig.starCount;index++){var f=index+1;var h=f-0.5;var e="fa-star-o theme-font3";if(a>=h&&a<f){e="fa-star-half-o theme-font5"}else{if(a>=f){e="fa-star theme-font5"}}$('<div class="fa '+e+' " aria-hidden="true"></div>').appendTo(g)}}if(typeof(tagArray)=="object"&&tagArray instanceof Array&&tagArray.length>0){var i=$(".waiter-evaluate-comment-panel>.tags").empty();$(tagArray).each(function(k,l){var m=" theme-font5";if(typeof(l.selected)=="boolean"&&l.selected==true){m=" selected theme-button-red";$("textarea").val(l.value)}i.append('<div class="tag'+m+'" data-id="'+l.id+'">'+l.value+"</div>")})}if(typeof(defaultComment)!="string"){defaultComment=""}$(".fa").click(function(k){$(this).removeClass("fa-star-o").removeClass("fa-star-half-o").removeClass("theme-font3").addClass("fa-star").addClass("theme-font5");$(this).prevAll(".fa").removeClass("fa-star-o").removeClass("fa-star-half-o").removeClass("theme-font3").addClass("fa-star").addClass("theme-font5");$(this).nextAll(".fa").removeClass("fa-star").removeClass("fa-star-half-o").removeClass("theme-font5").addClass("fa-star-o").addClass("theme-font3")});$(".tag").click(function(k){$(".tag").removeClass("selected").removeClass("theme-button-red").addClass("theme-font5");$(this).removeClass("theme-font5").addClass("selected").addClass("theme-button-red");if(typeof($("textarea").val())!="string"||$("textarea").val().trim()==""){$("textarea").val($(this).text())}else{$("textarea").val($("textarea").val()+","+$(this).text())}});$(".btn-submit").removeClass("theme-button").addClass("theme-rad-panel").click(function(m){$("html").showLoading();var s=$(".waiter-evaluate-info-panel .wapper").attr("waiter-id");if(typeof(s)!="string"||s.trim()==""){art.dialog({title:"提示",content:"服务员标识不存在",fixed:true,okValue:"关闭",ok:function(){return true}}).lock();return}var p=$(".fa-star").size();if(p<1){art.dialog({title:"提示",content:"请为服务员打分",fixed:true,okValue:"关闭",ok:function(){return true}}).lock();return}var q="";$(".tag.selected").each(function(t,u){if(t>0){q+=","}q+=$(u).attr("data-id")});var l=$("textarea").val();var k=b+"/h5/comment/addcomment";var o={};var n={content:l,ep:s,score:p,tags:q};var r=6000;JohnLeeConsole.print(">>>>>",k,"POST","timeout="+r+"ms");JohnLeeConsole.print(">>>>>",JSON.stringify(o),JSON.stringify(n));$.ajax({url:b+"/h5/comment/addcomment",timeout:r,type:"POST",cache:false,headers:o,data:n,dataType:"JSONP",jsonpCallback:"h5turbine",success:function(t,u){$("html").hideLoading();JohnLeeConsole.print("<<<<<",k,JSON.stringify(t));if(typeof(t)!="object"){art.dialog({title:"错误",content:"服务器返回数据格式错误",fixed:true,okValue:"关闭",ok:function(){return true}}).lock();return}if(t.code!=10000){art.dialog({title:"错误",content:"代码："+t.code+"<br/>信息："+t.msg,fixed:true,okValue:"关闭",ok:function(){return true}}).lock();return}art.dialog({title:"提示",content:t.msg,fixed:true,lock:true,okValue:"关闭",beforeunload:function(){try{JohnLeeConsole.print(">>>>> Wechart[/pages/index/index]");wx.miniProgram.getEnv(function(w){if(w.miniprogram){wx.miniProgram.switchTab({url:"/pages/index/index"})}})}catch(v){JohnLeeConsole.print(">>XXXX>> Wechart-ERROR[/pages/index/index]",v)}return true}})},error:function(v,u,t){$("html").hideLoading();JohnLeeConsole.print("请求出错：",k,v,u,t);art.dialog({title:"错误",content:"网络异常，请稍候再试",fixed:true,okValue:"关闭",ok:function(){return true}}).lock()}})});$(".waiter-evaluate-comment-panel>textarea").css({resize:"none"}).text(defaultComment)});(function(d,a){var c={apiURLDomain:{devp:"https://dev-mobile.littlehotspot.com",prod:"https://mobile.littlehotspot.com"},starCount:5,startColor:{_default:"#333333",selected:"#eb6877"}};d.pageConfig=c;var b=d.logger;if(typeof(b)!="object"){b={}}b.SHOW_CONSOLE_CLICK_COUNT=0;d.logger=b})(window,jQuery);