$(document).ready(function(c){$("input,textarea").blur(function(){$("html,body").animate({scrollTop:document.documentElement.clientHeight},500)});var b=pageConfig.apiURLDomain.prod;if("devp"==runEnv){b=pageConfig.apiURLDomain.devp}$(".waiter-evaluate-score-panel>.wapper>.lable").click(function(l){logger.SHOW_CONSOLE_CLICK_COUNT++;if(logger.SHOW_CONSOLE_CLICK_COUNT>=30){$("#console").show()}});JohnLeeConsole.print("服务员信息："+JSON.stringify(waiterInfo));JohnLeeConsole.print("默认分值："+JSON.stringify(defaultScore));JohnLeeConsole.print("标签列表："+JSON.stringify(tagArray));JohnLeeConsole.print("默认评论："+JSON.stringify(defaultComment));if(typeof(waiterInfo)=="object"){var k=$(".waiter-evaluate-info-panel");if(typeof(waiterInfo.name)=="string"){k.find(".wapper").attr("waiter-id",waiterInfo.id)}if(typeof(waiterInfo.name)=="string"){k.find(".info>.name").text(waiterInfo.name)}if(typeof(waiterInfo.title)=="string"){k.find(".info>.title").text(waiterInfo.title)}if(typeof(waiterInfo.photo)=="string"){k.find("img.photo").attr("src",waiterInfo.photo)}}var a=0;if(typeof(defaultScore)!="number"){a=defaultScore}else{try{a=parseFloat(defaultScore)}catch(d){a=0}}var g=$(".waiter-evaluate-score-panel .star-group").empty();if(typeof(pageConfig.starCount)=="number"&&pageConfig.starCount>0){for(index=0;index<pageConfig.starCount;index++){var f=index+1;var h=f-0.5;var e="fa-star-o";var i=pageConfig.startColor._default;if(a>=h&&a<f){e="fa-star-half-o";i=pageConfig.startColor.selected}else{if(a>=f){e="fa-star";i=pageConfig.startColor.selected}}$('<div class="fa '+e+'" aria-hidden="true"></div>').css({color:i}).appendTo(g)}}if(typeof(tagArray)=="object"&&tagArray instanceof Array&&tagArray.length>0){var j=$(".waiter-evaluate-comment-panel>.tags").empty();$(tagArray).each(function(l,m){var n="";if(typeof(m.selected)=="boolean"&&m.selected==true){n=" selected";$("textarea").val(m.value)}j.append('<div class="tag'+n+'" data-id="'+m.id+'">'+m.value+"</div>")})}if(typeof(defaultComment)!="string"){defaultComment=""}$(".fa").click(function(l){$(this).removeClass("fa-star-o").removeClass("fa-star-half-o").addClass("fa-star").css({color:pageConfig.startColor.selected});$(this).prevAll(".fa").removeClass("fa-star-o").removeClass("fa-star-half-o").addClass("fa-star").css({color:pageConfig.startColor.selected});$(this).nextAll(".fa").removeClass("fa-star").removeClass("fa-star-half-o").addClass("fa-star-o").css({color:pageConfig.startColor._default})});$(".tag").click(function(l){$(".tag").removeClass("selected");$(this).addClass("selected");if(typeof($("textarea").val())!="string"||$("textarea").val().trim()==""){$("textarea").val($(this).text())}else{$("textarea").val($("textarea").val()+","+$(this).text())}});$(".btn-submit").click(function(n){$("html").showLoading();var t=$(".waiter-evaluate-info-panel .wapper").attr("waiter-id");if(typeof(t)!="string"||t.trim()==""){art.dialog({title:"提示",content:"服务员标识不存在",fixed:true,okValue:"关闭",ok:function(){return true}}).lock();return}var q=$(".fa-star").size();if(q<1){art.dialog({title:"提示",content:"请为服务员打分",fixed:true,okValue:"关闭",ok:function(){return true}}).lock();return}var r="";$(".tag.selected").each(function(u,v){if(u>0){r+=","}r+=$(v).attr("data-id")});var m=$("textarea").val();var l=b+"/h5/comment/addcomment";var p={};var o={content:m,ep:t,score:q,tags:r};var s=6000;JohnLeeConsole.print(">>>>>",l,"POST","timeout="+s+"ms");JohnLeeConsole.print(">>>>>",JSON.stringify(p),JSON.stringify(o));$.ajax({url:b+"/h5/comment/addcomment",timeout:s,type:"POST",cache:false,headers:p,data:o,dataType:"JSONP",jsonpCallback:"h5turbine",success:function(u,v){$("html").hideLoading();JohnLeeConsole.print("<<<<<",l,JSON.stringify(u));if(typeof(u)!="object"){art.dialog({title:"错误",content:"服务器返回数据格式错误",fixed:true,okValue:"关闭",ok:function(){return true}}).lock();return}if(u.code!=10000){art.dialog({title:"错误",content:"代码："+u.code+"<br/>信息："+u.msg,fixed:true,okValue:"关闭",ok:function(){return true}}).lock();return}art.dialog({title:"提示",content:u.msg,fixed:true,lock:true,okValue:"关闭",beforeunload:function(){try{JohnLeeConsole.print(">>>>> Wechart[/pages/index/index]");wx.miniProgram.getEnv(function(x){if(x.miniprogram){wx.miniProgram.switchTab({url:"/pages/index/index"})}})}catch(w){JohnLeeConsole.print(">>XXXX>> Wechart-ERROR[/pages/index/index]",w)}return true}})},error:function(w,v,u){$("html").hideLoading();JohnLeeConsole.print("请求出错：",l,w,v,u);art.dialog({title:"错误",content:"网络异常，请稍候再试",fixed:true,okValue:"关闭",ok:function(){return true}}).lock()}})});$(".waiter-evaluate-comment-panel>textarea").css({resize:"none"}).text(defaultComment)});(function(d,a){var c={apiURLDomain:{devp:"https://dev-mobile.littlehotspot.com",prod:"https://mobile.littlehotspot.com"},starCount:5,startColor:{_default:"#333333",selected:"#eb6877"}};d.pageConfig=c;var b=d.logger;if(typeof(b)!="object"){b={}}b.SHOW_CONSOLE_CLICK_COUNT=0;d.logger=b})(window,jQuery);